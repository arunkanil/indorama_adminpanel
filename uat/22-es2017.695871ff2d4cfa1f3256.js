(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"0OHv":function(t,e,a){"use strict";a.r(e),a.d(e,"SMSCampaignsModule",function(){return B});var i=a("SVse"),s=a("s7LF"),l=a("FE24"),n=a("2ZVE"),o=a("iInd"),r=a("R7Hv"),b=a("7nfi"),d=a("8Y7J"),c=a("EApP"),u=a("YFAK"),g=a("LqlI");const h=["messageModal"],m=["detailsModal"];function p(t,e){if(1&t&&(d.Sb(0,"option",45),d.Dc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.id),d.Ab(1),d.Fc(" ",t.attributes.Name," ")}}function S(t,e){if(1&t&&(d.Sb(0,"option",45),d.Dc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.id),d.Ab(1),d.Fc(" ",t.attributes.Name," ")}}function v(t,e){if(1&t&&(d.Sb(0,"option",45),d.Dc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.id),d.Ab(1),d.Fc(" ",t.attributes.Name," ")}}function f(t,e){if(1&t&&(d.Sb(0,"option",45),d.Dc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.id),d.Ab(1),d.Fc(" ",t.attributes.Name," ")}}function R(t,e){if(1&t){const t=d.Tb();d.Sb(0,"div",5),d.Sb(1,"div",22),d.Sb(2,"div",23),d.Sb(3,"label",35),d.Dc(4,"State"),d.Rb(),d.Sb(5,"select",36),d.Zb("change",function(e){return d.vc(t),d.cc().filterLGA(e)}),d.Sb(6,"option",37),d.Dc(7,"Choose..."),d.Rb(),d.Bc(8,p,2,2,"option",38),d.Rb(),d.Rb(),d.Sb(9,"div",23),d.Sb(10,"label",39),d.Dc(11,"City"),d.Rb(),d.Sb(12,"select",40),d.Zb("change",function(e){return d.vc(t),d.cc().filterVillage(e)}),d.Sb(13,"option",37),d.Dc(14,"Choose..."),d.Rb(),d.Bc(15,S,2,2,"option",38),d.Rb(),d.Rb(),d.Rb(),d.Sb(16,"div",22),d.Sb(17,"div",23),d.Sb(18,"label",41),d.Dc(19,"LGA"),d.Rb(),d.Sb(20,"select",42),d.Zb("change",function(e){return d.vc(t),d.cc().filterArea(e)}),d.Sb(21,"option",37),d.Dc(22,"Choose..."),d.Rb(),d.Bc(23,v,2,2,"option",38),d.Rb(),d.Rb(),d.Sb(24,"div",23),d.Sb(25,"label",43),d.Dc(26,"Village"),d.Rb(),d.Sb(27,"select",44),d.Sb(28,"option",37),d.Dc(29,"Choose..."),d.Rb(),d.Bc(30,f,2,2,"option",38),d.Rb(),d.Rb(),d.Rb(),d.Rb()}if(2&t){const t=d.cc();d.Ab(8),d.jc("ngForOf",t.States),d.Ab(7),d.jc("ngForOf",t.Areas),d.Ab(8),d.jc("ngForOf",t.LGA),d.Ab(7),d.jc("ngForOf",t.Villages)}}function A(t,e){1&t&&d.Nb(0,"span",46)}const D=["messageModal"],w=["detailsModal"];function C(t,e){1&t&&(d.Sb(0,"td"),d.Sb(1,"b"),d.Dc(2,"All Farmers"),d.Rb(),d.Rb())}function y(t,e){if(1&t&&(d.Sb(0,"td"),d.Dc(1," State - "),d.Sb(2,"b"),d.Dc(3),d.Rb(),d.Nb(4,"br"),d.Dc(5,"LGA - "),d.Sb(6,"b"),d.Dc(7),d.Rb(),d.Nb(8,"br"),d.Dc(9,"City - "),d.Sb(10,"b"),d.Dc(11),d.Rb(),d.Nb(12,"br"),d.Dc(13,"Village - "),d.Sb(14,"b"),d.Dc(15),d.Rb(),d.Rb()),2&t){const t=d.cc();d.Ab(3),d.Ec(null==t.details||null==t.details.attributes||null==t.details.attributes.state||null==t.details.attributes.state.data||null==t.details.attributes.state.data.attributes?null:t.details.attributes.state.data.attributes.Name),d.Ab(4),d.Ec(null==t.details||null==t.details.attributes||null==t.details.attributes.lga||null==t.details.attributes.lga.data||null==t.details.attributes.lga.data.attributes?null:t.details.attributes.lga.data.attributes.Name),d.Ab(4),d.Ec(null==t.details||null==t.details.attributes||null==t.details.attributes.area||null==t.details.attributes.area.data||null==t.details.attributes.area.data.attributes?null:t.details.attributes.area.data.attributes.Name),d.Ab(4),d.Ec(null==t.details||null==t.details.attributes||null==t.details.attributes.village||null==t.details.attributes.village.data||null==t.details.attributes.village.data.attributes?null:t.details.attributes.village.data.attributes.Name)}}function M(t,e){if(1&t&&(d.Sb(0,"td"),d.Dc(1),d.Rb()),2&t){const t=d.cc();d.Ab(1),d.Fc(" ",null==t.details||null==t.details.attributes||null==t.details.attributes.SMSGatewayResponse||null==t.details.attributes.SMSGatewayResponse.error?null:t.details.attributes.SMSGatewayResponse.error.message," ")}}function F(t,e){if(1&t&&(d.Sb(0,"td"),d.Dc(1),d.Rb()),2&t){const t=d.cc();d.Ab(1),d.Fc(" ",null==t.details||null==t.details.attributes||null==t.details.attributes.SMSGatewayResponse||null==t.details.attributes.SMSGatewayResponse.data?null:t.details.attributes.SMSGatewayResponse.data.message," ")}}function G(t,e){1&t&&d.Nb(0,"span",11)}function N(t,e){if(1&t){const t=d.Tb();d.Sb(0,"div",4),d.Sb(1,"div",12),d.Sb(2,"ag-grid-angular",13,14),d.Zb("gridReady",function(e){return d.vc(t),d.cc().onGridReady(e)}),d.Rb(),d.Rb(),d.Rb()}if(2&t){const t=d.cc();d.Ab(2),d.jc("columnDefs",t.columnDefs)("rowData",t.rowData)("pagination",!0)}}const L=[{path:"",children:[{path:"",redirectTo:"sms-campaigns"},{path:"all",component:(()=>{class t{constructor(t,e,a,i){this.dataservice=t,this.router=e,this.fb=a,this.toastr=i,this.loading=!0,this.btnLoading=!1,this.disableButton=!0,this.disableNextButton=!1,this.disablePrevButton=!0,this.pageSize=20,this.from=1,this.to=20,this.count=1,this.columnDefs=[],this.Farmers=[],this.Villages=[],this.LGA=[],this.Areas=[],this.States=[],this.rowData=[],this.selectedRows=[],this.years=[],this.filter={},this.messageForm=this.fb.group({isAllFarmers:[!1],message:["",s.s.required],village:[""],area:[""],lga:[""],state:[""]}),this.columnDefs=[...b.l],this.rowSelection="single"}ngOnInit(){this.loading=!0,console.log(this.router),this.getSmsCampaigns(),this.getAreas(),this.getLGAs(),this.getStates(),this.getVillages()}getSmsCampaigns(){this.dataservice.getSmsCampaigns(1,this.pageSize).valueChanges.subscribe(t=>{var e,a,i,s,l,n;this.rowData=t.data.smsCampaigns.data,this.meta=t.data.smsCampaigns.meta,(null===(a=null===(e=this.meta)||void 0===e?void 0:e.pagination)||void 0===a?void 0:a.pageCount)<=1&&(this.disablePrevButton=!0,this.disableNextButton=!0),(null===(s=null===(i=this.meta)||void 0===i?void 0:i.pagination)||void 0===s?void 0:s.total)<this.pageSize&&(this.to=null===(n=null===(l=this.meta)||void 0===l?void 0:l.pagination)||void 0===n?void 0:n.total)})}loadNext(){var t,e,a,i;this.count++,this.disablePrevButton=!1,this.from=this.from+this.pageSize,this.to=this.to+this.pageSize>(null===(e=null===(t=this.meta)||void 0===t?void 0:t.pagination)||void 0===e?void 0:e.total)?null===(i=null===(a=this.meta)||void 0===a?void 0:a.pagination)||void 0===i?void 0:i.total:this.to+this.pageSize,this.count===this.meta.pagination.pageCount&&(this.disableNextButton=!0),this.dataservice.getSmsCampaigns(this.count,this.pageSize).valueChanges.subscribe(t=>{this.meta=t.data.smsCampaigns.meta,this.rowData=t.data.smsCampaigns.data})}loadPrev(){this.count--,this.count<this.meta.pagination.pageCount&&(this.disableNextButton=!1),1===this.count&&(this.disablePrevButton=!0),this.from=this.from-this.pageSize,this.to=this.to-this.rowData.length,this.dataservice.getSmsCampaigns(this.count,this.pageSize).valueChanges.subscribe(t=>{this.meta=t.data.smsCampaigns.meta,this.rowData=t.data.smsCampaigns.data})}getStates(){this.dataservice.getStates().valueChanges.subscribe(t=>{console.log("getStates",t.data.states.data),this.States=t.data.states.data})}getLGAs(t){this.dataservice.getLGAs(t).valueChanges.subscribe(t=>{console.log("getLGAs",t.data.lgas.data),this.LGA=t.data.lgas.data})}getAreas(t){this.dataservice.getAreas(t).valueChanges.subscribe(t=>{console.log("getAreas",t.data.areas.data),this.Areas=t.data.areas.data})}getVillages(t){this.dataservice.getVillages(t).valueChanges.subscribe(t=>{console.log("getVillages",t.data.villages.data),this.Villages=t.data.villages.data})}filterLGA(t){this.getLGAs(t.target.value)}filterArea(t){this.getAreas(t.target.value)}filterVillage(t){this.getVillages(t.target.value)}onGridReady(t){this.gridApi=t.api,this.gridColumnApi=t.columnApi,this.gridApi.sizeColumnsToFit()}onRowClicked(t){console.log("row",t.data)}onSelectionChanged(t){this.selectedRows=this.gridApi.getSelectedRows(),this.disableButton=!(this.selectedRows.length>0),this.router.navigate(["/sms-campaigns/details",this.selectedRows[0].id],{state:{data:this.selectedRows}}),console.log(this.selectedRows,this.selectedRows[0])}openModal(){this.messageModal.show()}sendMessage(){this.btnLoading=!0,console.log(this.messageForm.value,"sendmessage"),this.dataservice.createSMSCampaign(this.messageForm.value).subscribe(t=>{console.log("response",t),t.data.createSmsCampaign?(this.toastr.success("Success!"),this.btnLoading=!1,this.messageModal.hide(),this.getSmsCampaigns()):(this.toastr.error("Failed!"),this.btnLoading=!1)},t=>{this.btnLoading=!1})}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(r.a),d.Mb(o.c),d.Mb(s.c),d.Mb(c.b))},t.\u0275cmp=d.Gb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&(d.Ic(h,1),d.Ic(m,1)),2&t){let t;d.rc(t=d.ac())&&(e.messageModal=t.first),d.rc(t=d.ac())&&(e.detailsModal=t.first)}},decls:53,vars:15,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-header",2,"display","flex","justify-content","space-between"],["type","button","data-toggle","modal",1,"btn","btn-primary",3,"disabled","click"],[1,"card-body"],[1,"row"],[1,"col-12"],["id","myGrid","animateRows","true",1,"ag-theme-alpine",2,"width","100%","height","65vh",3,"columnDefs","rowData","rowSelection","selectionChanged","gridReady"],["agGrid",""],[1,"float-left","mt-3"],["type","button",1,"btn","btn-primary","float-right","m-2",3,"disabled","click"],[1,"float-right","mt-3"],["bsModal","","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade"],["messageModal","bs-modal"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"col"],[1,"form-group"],[1,"switch"],["type","checkbox","id","isAllFarmers","maxlength","160","name","isAllFarmers","formControlName","isAllFarmers"],[1,"slider","round"],[1,"on"],[1,"off"],["class","row",4,"ngIf"],["for","name"],["rows","5","id","message","maxlength","160","name","message","formControlName","message","placeholder","Max 160 characters",1,"form-control"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["for","state"],["id","state","ngModel","","name","state","formControlName","state",1,"form-control",3,"change"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],["for","area"],["id","area","ngModel","","name","area","formControlName","area",1,"form-control",3,"change"],["for","lga"],["id","lga","ngModel","","name","lga","formControlName","lga",1,"form-control",3,"change"],["for","village"],["id","village","ngModel","","name","village","formControlName","village",1,"form-control"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(t,e){if(1&t){const t=d.Tb();d.Sb(0,"div",0),d.Sb(1,"div",1),d.Sb(2,"div",2),d.Sb(3,"h2"),d.Dc(4,"SMS Campaigns"),d.Rb(),d.Sb(5,"div"),d.Sb(6,"button",3),d.Zb("click",function(){return e.openModal()}),d.Dc(7," Create new campaign "),d.Rb(),d.Rb(),d.Rb(),d.Sb(8,"div",4),d.Sb(9,"div",5),d.Sb(10,"div",6),d.Sb(11,"ag-grid-angular",7,8),d.Zb("selectionChanged",function(t){return e.onSelectionChanged(t)})("gridReady",function(t){return e.onGridReady(t)}),d.Rb(),d.Sb(13,"span",9),d.Dc(14),d.Rb(),d.Sb(15,"button",10),d.Zb("click",function(){return e.loadNext()}),d.Dc(16," Next "),d.Rb(),d.Sb(17,"span",11),d.Dc(18),d.Rb(),d.Sb(19,"button",10),d.Zb("click",function(){return e.loadPrev()}),d.Dc(20," Prev "),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Sb(21,"div",12,13),d.Sb(23,"div",14),d.Sb(24,"div",15),d.Sb(25,"div",16),d.Sb(26,"h4",17),d.Dc(27,"New Campaign"),d.Rb(),d.Sb(28,"button",18),d.Zb("click",function(){return d.vc(t),d.sc(22).hide()}),d.Sb(29,"span",19),d.Dc(30,"\xd7"),d.Rb(),d.Rb(),d.Rb(),d.Sb(31,"div",20),d.Sb(32,"form",21),d.Zb("ngSubmit",function(){return e.sendMessage()}),d.Sb(33,"div",5),d.Sb(34,"div",22),d.Sb(35,"div",23),d.Sb(36,"label",24),d.Nb(37,"input",25),d.Sb(38,"div",26),d.Sb(39,"span",27),d.Dc(40,"Filter"),d.Rb(),d.Sb(41,"span",28),d.Dc(42,"All"),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Bc(43,R,31,4,"div",29),d.Sb(44,"div",23),d.Sb(45,"label",30),d.Dc(46,"Message body"),d.Rb(),d.Nb(47,"textarea",31),d.Rb(),d.Sb(48,"button",32),d.Zb("click",function(){return d.vc(t),d.sc(22).hide()}),d.Dc(49," Close "),d.Rb(),d.Sb(50,"button",33),d.Bc(51,A,1,0,"span",34),d.Dc(52," Create "),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb()}2&t&&(d.Ab(6),d.jc("disabled",!e.disableButton),d.Ab(5),d.jc("columnDefs",e.columnDefs)("rowData",e.rowData)("rowSelection",e.rowSelection),d.Ab(3),d.Hc("",e.from," to ",e.to," of ",null==e.meta||null==e.meta.pagination?null:e.meta.pagination.total,""),d.Ab(1),d.jc("disabled",e.disableNextButton),d.Ab(3),d.Gc("Page ",null==e.meta||null==e.meta.pagination?null:e.meta.pagination.page," of ",null==e.meta||null==e.meta.pagination?null:e.meta.pagination.pageCount,""),d.Ab(1),d.jc("disabled",e.disablePrevButton),d.Ab(13),d.jc("formGroup",e.messageForm),d.Ab(11),d.jc("ngIf",null==e.messageForm.value?null:e.messageForm.value.isAllFarmers),d.Ab(7),d.jc("disabled",e.btnLoading||!e.messageForm.valid),d.Ab(1),d.jc("ngIf",e.btnLoading))},directives:[u.a,g.a,s.t,s.j,s.e,s.a,s.g,s.i,s.d,i.k,s.b,s.q,s.m,s.u,i.j],encapsulation:2}),t})(),data:{title:"SMS Campaign"}},{path:"details/:id",component:(()=>{class t{constructor(t,e,a,i,l){this.dataservice=t,this.activatedRouter=e,this.router=a,this.fb=i,this.toastr=l,this.dateConverter=b.r,this.dateConverterMin=b.s,this.loading=!0,this.btnLoading=!1,this.columnDefs=[],this.rowData=[],this.details=[],this.messageForm=this.fb.group({isAllFarmers:[!1],message:["",s.s.required],village:[""],area:[""],lga:[""],state:[""]}),this.columnDefs=[...b.e],this.rowSelection="single"}ngOnInit(){this.loading=!0,this.activatedRouter.params.subscribe(t=>{this.id=t.id}),console.log(this.router),this.getSmsCampaigns()}onGridReady(t){this.gridApi=t.api,this.gridColumnApi=t.columnApi,this.gridApi.sizeColumnsToFit()}getSmsCampaigns(){this.dataservice.getSmsCampaigns(1,10,this.id).valueChanges.subscribe(t=>{this.details=t.data.smsCampaigns.data[0],console.log(this.details)})}getDeliveryReports(){var t,e,a,i,s,l;this.btnLoading=!0,this.dataservice.fetchMessage(null===(e=null===(t=this.details)||void 0===t?void 0:t.attributes)||void 0===e?void 0:e.apiKey,null===(l=null===(s=null===(i=null===(a=this.details)||void 0===a?void 0:a.attributes)||void 0===i?void 0:i.SMSGatewayResponse)||void 0===s?void 0:s.data)||void 0===l?void 0:l.message_id).subscribe(t=>{console.log("getDeliveryReports",t),this.rowData=t.data,this.btnLoading=!1},t=>{console.error("error caught in component",t),this.btnLoading=!1,this.toastr.error("Unable to fetch data")})}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(r.a),d.Mb(o.a),d.Mb(o.c),d.Mb(s.c),d.Mb(c.b))},t.\u0275cmp=d.Gb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&(d.Ic(D,1),d.Ic(w,1)),2&t){let t;d.rc(t=d.ac())&&(e.messageModal=t.first),d.rc(t=d.ac())&&(e.detailsModal=t.first)}},decls:41,vars:10,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-header",2,"display","flex","justify-content","space-between"],[1,"card-body"],[1,"row"],[1,"col"],[1,"table","table-striped"],[4,"ngIf"],["type","button",1,"btn","btn-primary","float-right","m-2",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","row",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"col-12"],["id","myGrid","animateRows","true",1,"ag-theme-alpine",2,"width","100%","height","65vh",3,"columnDefs","rowData","pagination","gridReady"],["agGrid",""]],template:function(t,e){1&t&&(d.Sb(0,"div",0),d.Sb(1,"div",1),d.Sb(2,"div",2),d.Sb(3,"h2"),d.Dc(4,"SMS Campaign Details"),d.Rb(),d.Nb(5,"span"),d.Rb(),d.Sb(6,"div",3),d.Sb(7,"div",4),d.Sb(8,"div",5),d.Sb(9,"div",4),d.Sb(10,"table",6),d.Sb(11,"tbody"),d.Sb(12,"tr"),d.Sb(13,"td"),d.Dc(14,"ID"),d.Rb(),d.Sb(15,"td"),d.Dc(16),d.Rb(),d.Rb(),d.Sb(17,"tr"),d.Sb(18,"td"),d.Dc(19,"Target"),d.Rb(),d.Bc(20,C,3,0,"td",7),d.Bc(21,y,16,4,"td",7),d.Rb(),d.Sb(22,"tr"),d.Sb(23,"td"),d.Dc(24,"Message"),d.Rb(),d.Sb(25,"td"),d.Dc(26),d.Rb(),d.Rb(),d.Sb(27,"tr"),d.Sb(28,"td"),d.Dc(29,"Created at"),d.Rb(),d.Sb(30,"td"),d.Dc(31),d.Rb(),d.Rb(),d.Sb(32,"tr"),d.Sb(33,"td"),d.Dc(34,"Status"),d.Rb(),d.Bc(35,M,2,1,"td",7),d.Bc(36,F,2,1,"td",7),d.Rb(),d.Rb(),d.Rb(),d.Sb(37,"button",8),d.Zb("click",function(){return e.getDeliveryReports()}),d.Bc(38,G,1,0,"span",9),d.Dc(39," Fetch Delivery Report "),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Bc(40,N,4,3,"div",10),d.Rb(),d.Rb(),d.Rb()),2&t&&(d.Ab(16),d.Ec(null==e.details?null:e.details.id),d.Ab(4),d.jc("ngIf",null==e.details||null==e.details.attributes?null:e.details.attributes.isAllFarmers),d.Ab(1),d.jc("ngIf",!(null!=e.details&&null!=e.details.attributes&&e.details.attributes.isAllFarmers)),d.Ab(5),d.Fc(" ",null==e.details||null==e.details.attributes?null:e.details.attributes.message," "),d.Ab(5),d.Ec(e.dateConverter(null==e.details||null==e.details.attributes?null:e.details.attributes.createdAt)),d.Ab(4),d.jc("ngIf",!(null!=e.details&&null!=e.details.attributes&&null!=e.details.attributes.SMSGatewayResponse&&e.details.attributes.SMSGatewayResponse.data)),d.Ab(1),d.jc("ngIf",null==e.details||null==e.details.attributes||null==e.details.attributes.SMSGatewayResponse?null:e.details.attributes.SMSGatewayResponse.data),d.Ab(1),d.jc("disabled",e.btnLoading),d.Ab(1),d.jc("ngIf",e.btnLoading),d.Ab(2),d.jc("ngIf",e.rowData.length>0))},directives:[i.k,u.a],encapsulation:2}),t})(),data:{title:"SMS Campaign Details"}}]}];let j=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({imports:[[o.g.forChild(L)],o.g]}),t})(),B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({imports:[[i.c,n.a,s.o,j,u.b.withComponents([]),l.c.forRoot(),g.b.forRoot(),s.f]]}),t})()}}]);