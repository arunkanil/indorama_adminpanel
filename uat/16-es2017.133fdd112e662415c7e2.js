(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"N8R/":function(t,e,i){"use strict";i.r(e),i.d(e,"CropPricesModule",function(){return k});var o=i("SVse"),s=i("s7LF"),a=i("FE24"),r=i("2ZVE"),c=i("iInd"),n=i("R7Hv"),l=i("7nfi"),d=i("AytR"),b=i("8Y7J"),u=i("EApP"),p=i("YFAK"),h=i("LqlI");const g=["cropPriceModal"],m=["approveModal"];function v(t,e){if(1&t){const t=b.Tb();b.Sb(0,"ul",51),b.Sb(1,"li",52),b.Sb(2,"a",53),b.Zb("click",function(){return b.vc(t),b.cc().toggleCropPrices("All")}),b.Dc(3,"All"),b.Rb(),b.Sb(4,"a",53),b.Zb("click",function(){return b.vc(t),b.cc().toggleCropPrices("Approvalpending")}),b.Dc(5,"Approval pending"),b.Rb(),b.Sb(6,"a",53),b.Zb("click",function(){return b.vc(t),b.cc().toggleCropPrices("Rejected")}),b.Dc(7,"Rejected"),b.Rb(),b.Rb(),b.Rb()}}function f(t,e){if(1&t&&(b.Sb(0,"option",54),b.Dc(1),b.Rb()),2&t){const t=e.$implicit;b.kc("value",t.id),b.Ab(1),b.Fc(" ",t.attributes.Name," ")}}function R(t,e){if(1&t&&(b.Sb(0,"option",54),b.Dc(1),b.Rb()),2&t){const t=e.$implicit;b.kc("value",t.id),b.Ab(1),b.Fc(" ",t.attributes.Name," ")}}function S(t,e){if(1&t&&(b.Sb(0,"option",54),b.Dc(1),b.Rb()),2&t){const t=e.$implicit;b.kc("value",t.id),b.Ab(1),b.Fc(" ",t.attributes.Name," ")}}function P(t,e){if(1&t&&b.Nb(0,"img",55),2&t){const t=b.cc();b.kc("src",t.imageUrl,b.xc)}}function C(t,e){1&t&&b.Nb(0,"span",56)}const w=[{path:"",children:[{path:"",redirectTo:"cropprices"},{path:"all",component:(()=>{class t{constructor(t,e,i,o){this.dataservice=t,this.router=e,this.fb=i,this.toastr=o,this.loading=!0,this.btnLoading=!1,this.disableButton=!0,this.disableNextButton=!1,this.disablePrevButton=!0,this.selectedList="All",this.listCheck=!1,this.publicationState="PREVIEW",this.toApprove=void 0,this.isRejected=void 0,this.columnDefs=[],this.States=[],this.Markets=[],this.Crops=[],this.pageSize=20,this.from=1,this.to=20,this.count=1,this.cropPriceForm=this.fb.group({crop:["",s.s.required],state:["",s.s.required],market:["",s.s.required],Price:["",s.s.required],Unit:["",s.s.required],Image:[""]}),this.rowData=[],this.selectedRows=[],this.selectedYear=(new Date).getFullYear(),this.years=[],this.filter={},this.file=null,this.columnDefs=[...l.d],this.rowSelection="single"}ngOnInit(){this.loading=!0,console.log(this.router),this.getCropPrices(),this.getCrops(),this.getMarkets(),this.getStates()}getCropPrices(){this.dataservice.getCropPrices(1,this.pageSize,this.publicationState,this.toApprove,this.isRejected).valueChanges.subscribe(t=>{var e,i,o,s,a,r;this.rowData=t.data.cropPrices.data,this.meta=t.data.cropPrices.meta,(null===(i=null===(e=this.meta)||void 0===e?void 0:e.pagination)||void 0===i?void 0:i.pageCount)<=1&&(this.disablePrevButton=!0,this.disableNextButton=!0),(null===(s=null===(o=this.meta)||void 0===o?void 0:o.pagination)||void 0===s?void 0:s.total)<this.pageSize&&(this.to=null===(r=null===(a=this.meta)||void 0===a?void 0:a.pagination)||void 0===r?void 0:r.total)})}getCrops(){this.dataservice.getCrops().valueChanges.subscribe(t=>{this.Crops=t.data.crops.data})}loadNext(){var t,e,i,o;this.count++,this.disablePrevButton=!1,this.from=this.from+this.pageSize,this.to=this.to+this.pageSize>(null===(e=null===(t=this.meta)||void 0===t?void 0:t.pagination)||void 0===e?void 0:e.total)?null===(o=null===(i=this.meta)||void 0===i?void 0:i.pagination)||void 0===o?void 0:o.total:this.to+this.pageSize,this.count===this.meta.pagination.pageCount&&(this.disableNextButton=!0),this.dataservice.getCropPrices(this.count,this.pageSize,this.publicationState,this.toApprove).valueChanges.subscribe(t=>{this.meta=t.data.cropPrices.meta,this.rowData=t.data.cropPrices.data})}loadPrev(){this.count--,this.count<this.meta.pagination.pageCount&&(this.disableNextButton=!1),1===this.count&&(this.disablePrevButton=!0),this.from=this.from-this.pageSize,this.to=this.to-this.rowData.length,this.dataservice.getCropPrices(this.count,this.pageSize,this.publicationState,this.toApprove).valueChanges.subscribe(t=>{this.meta=t.data.cropPrices.meta,this.rowData=t.data.cropPrices.data})}getStates(){this.dataservice.getStates().valueChanges.subscribe(t=>{console.log("getStates",t.data.states.data),this.States=t.data.states.data})}getMarkets(t){this.dataservice.getMarkets(t).valueChanges.subscribe(t=>{console.log("getMarkets",t.data.markets.data),this.Markets=t.data.markets.data})}filterMarkets(t){this.getMarkets(t.target.value)}toggleCropPrices(t){switch(t){case"Rejected":this.selectedList="Rejected",this.publicationState="PREVIEW",this.toApprove=null,this.isRejected=!0,this.getCropPrices();break;case"Approvalpending":this.selectedList="Pending",this.publicationState="PREVIEW",this.toApprove=null,this.isRejected=!1,this.getCropPrices();break;case"All":this.selectedList="All",this.publicationState="PREVIEW",this.toApprove=void 0,this.isRejected=void 0,this.getCropPrices()}}onGridReady(t){this.gridApi=t.api,this.gridColumnApi=t.columnApi,this.gridApi.sizeColumnsToFit()}onRowClicked(t){console.log("row",t.data)}onSelectionChanged(t){this.selectedRows=this.gridApi.getSelectedRows(),this.disableButton=!(this.selectedRows.length>0)}onChange(t){this.file=[];for(var e=0;e<t.target.files.length;e++)this.file.push(t.target.files[e]);console.log(this.file)}approveOrReject(t){let e=null;t||(e=new Date),this.dataservice.UpdateCropPrice(void 0,this.selectedRows[0].id,void 0,t,e).subscribe(t=>{console.log("response",t),t.data.updateCropPrice&&(this.toastr.success("Success!"),this.getCropPrices(),this.file=null,this.approveModal.hide(),this.gridApi.deselectAll(),this.btnLoading=!1)},t=>{this.toastr.error("Failed. Please check the fields!"),this.btnLoading=!1})}openApproveModal(){this.approveModal.show()}openModal(t){var e,i,o,a,r,c,n,l;this.imageUrl=null,this.cropPriceModal.show(),t?(this.cropPriceForm=this.fb.group({crop:[this.selectedRows[0].attributes.crop.data.id,s.s.required],state:[this.selectedRows[0].attributes.state.data.id,s.s.required],market:[this.selectedRows[0].attributes.market.data.id,s.s.required],Price:[this.selectedRows[0].attributes.Price,s.s.required],Unit:[this.selectedRows[0].attributes.Unit,s.s.required],Image:[null===(i=null===(e=this.selectedRows[0].attributes.Image)||void 0===e?void 0:e.data)||void 0===i?void 0:i.id,s.s.required]}),this.imageUrl=(null===(r=null===(a=null===(o=this.selectedRows[0].attributes.Image)||void 0===o?void 0:o.data)||void 0===a?void 0:a.attributes)||void 0===r?void 0:r.url)?`${d.a.apiUrl}`+(null===(l=null===(n=null===(c=this.selectedRows[0].attributes.Image)||void 0===c?void 0:c.data)||void 0===n?void 0:n.attributes)||void 0===l?void 0:l.url):null):(this.cropPriceForm=this.fb.group({crop:["",s.s.required],state:["",s.s.required],market:["",s.s.required],Price:["",s.s.required],Unit:["",s.s.required],Image:["",s.s.required]}),this.imageUrl=null)}cropPriceSubmit(){let t={};this.btnLoading=!0,console.log(this.cropPriceForm.value),this.disableButton?this.dataservice.upload(this.file).subscribe(e=>{var i;200==e.status?(console.log(e),this.dataservice.AddCropPrice(this.cropPriceForm.value,null===(i=e.body[0])||void 0===i?void 0:i.id).subscribe(e=>{t=e.data,console.log("response",e),e.data.createCropPrice&&(this.toastr.success("Success!"),this.getCropPrices(),this.file=null,this.cropPriceModal.hide(),this.cropPriceForm.reset(),this.gridApi.deselectAll()),this.btnLoading=!1},t=>{this.toastr.error("Failed. Please check the fields!"),this.btnLoading=!1})):this.toastr.error("Image failed to upload!")}):this.file?this.dataservice.upload(this.file).subscribe(e=>{var i;200==e.status&&(console.log(e),this.dataservice.UpdateCropPrice(this.cropPriceForm.value,this.selectedRows[0].id,null===(i=e.body[0])||void 0===i?void 0:i.id).subscribe(e=>{t=e.data,console.log("response",e),e.data.updateCropPrice&&(this.toastr.success("Success!"),this.getCropPrices(),this.file=null,this.cropPriceModal.hide(),this.cropPriceForm.reset(),this.gridApi.deselectAll(),this.btnLoading=!1)},t=>{this.toastr.error("Failed. Please check the fields!"),this.btnLoading=!1}))}):this.dataservice.UpdateCropPrice(this.cropPriceForm.value,this.selectedRows[0].id,null).subscribe(e=>{t=e.data,console.log("response",e),e.data.updateCropPrice&&(this.toastr.success("Success!"),this.getCropPrices(),this.file=null,this.cropPriceModal.hide(),this.cropPriceForm.reset(),this.gridApi.deselectAll(),this.btnLoading=!1)},t=>{this.toastr.error("Failed. Please check the fields!"),this.btnLoading=!1})}}return t.\u0275fac=function(e){return new(e||t)(b.Mb(n.a),b.Mb(c.c),b.Mb(s.c),b.Mb(u.b))},t.\u0275cmp=b.Gb({type:t,selectors:[["ng-component"]],viewQuery:function(t,e){if(1&t&&(b.Ic(g,1),b.Ic(m,1)),2&t){let t;b.rc(t=b.ac())&&(e.cropPriceModal=t.first),b.rc(t=b.ac())&&(e.approveModal=t.first)}},decls:95,vars:21,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-header",2,"display","flex","justify-content","space-between"],["type","button","data-toggle","modal",1,"btn","btn-warning",3,"disabled","click"],["type","button","data-toggle","modal",1,"btn","btn-info",3,"disabled","click"],["type","button","data-toggle","modal",1,"btn","btn-primary",3,"disabled","click"],[1,"card-body"],[1,"row"],[1,"col-12"],["dropdown","",1,"btn-group","float-right","mb-3"],["dropdownToggle","","type","button",1,"btn","btn-primary","dropdown-toggle"],[1,"caret"],["class","dropdown-menu","role","menu",4,"dropdownMenu"],["id","myGrid","animateRows","true",1,"ag-theme-alpine",2,"width","100%","height","65vh",3,"columnDefs","rowData","rowSelection","selectionChanged","gridReady"],["agGrid",""],[1,"float-left","mt-3"],["type","button",1,"btn","btn-primary","float-right","m-2",3,"disabled","click"],[1,"float-right","mt-3"],["bsModal","","tabindex","-1","role","dialog","aria-labelledby","myModalLabel","aria-hidden","true",1,"modal","fade"],["cropPriceModal","bs-modal"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"form-group"],["for","state"],["id","state","required","","ngModel","","name","state","formControlName","state",1,"form-control",3,"change"],["value","","disabled","","selected","","hidden",""],[3,"value",4,"ngFor","ngForOf"],["for","market"],["id","market","required","","ngModel","","name","market","formControlName","market",1,"form-control"],["for","crop"],["id","crop","required","","ngModel","","name","crop","formControlName","crop",1,"form-control"],["for","name"],["type","text","id","Price","name","Price","formControlName","Price","placeholder","Enter price",1,"form-control"],["type","text","id","Unit","name","Unit","formControlName","Unit","placeholder","Enter unit",1,"form-control"],["for","Image"],["width","100","height","100","style","object-fit: cover",3,"src",4,"ngIf"],["type","file","id","Image","accept",".jpg,.jpeg,.JPEG,.png","name","Image","formControlName","Image","placeholder","Choose image",1,"form-control",3,"change"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary","ml-2",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["approveModal","bs-modal"],[1,"modal-dialog","modal-dialog-centered","modal-sm"],[1,"modal-body","text-center"],[1,"modal-footer","justify-content-around"],["type","button",1,"btn","btn-primary",3,"click"],["role","menu",1,"dropdown-menu"],["role","menuitem"],[1,"dropdown-item",3,"click"],[3,"value"],["width","100","height","100",2,"object-fit","cover",3,"src"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(t,e){if(1&t){const t=b.Tb();b.Sb(0,"div",0),b.Sb(1,"div",1),b.Sb(2,"div",2),b.Sb(3,"h2"),b.Dc(4,"Crop Prices Home"),b.Rb(),b.Sb(5,"div"),b.Sb(6,"button",3),b.Zb("click",function(){return e.openApproveModal()}),b.Dc(7," Approve / Reject "),b.Rb(),b.Sb(8,"button",4),b.Zb("click",function(){return e.openModal("Edit")}),b.Dc(9," Edit "),b.Rb(),b.Sb(10,"button",5),b.Zb("click",function(){return e.openModal()}),b.Dc(11," Add New Price "),b.Rb(),b.Rb(),b.Rb(),b.Sb(12,"div",6),b.Sb(13,"div",7),b.Sb(14,"div",8),b.Sb(15,"div",9),b.Sb(16,"button",10),b.Dc(17),b.Nb(18,"span",11),b.Rb(),b.Bc(19,v,8,0,"ul",12),b.Rb(),b.Rb(),b.Rb(),b.Sb(20,"div",7),b.Sb(21,"div",8),b.Sb(22,"ag-grid-angular",13,14),b.Zb("selectionChanged",function(t){return e.onSelectionChanged(t)})("gridReady",function(t){return e.onGridReady(t)}),b.Rb(),b.Sb(24,"span",15),b.Dc(25),b.Rb(),b.Sb(26,"button",16),b.Zb("click",function(){return e.loadNext()}),b.Dc(27," Next "),b.Rb(),b.Sb(28,"span",17),b.Dc(29),b.Rb(),b.Sb(30,"button",16),b.Zb("click",function(){return e.loadPrev()}),b.Dc(31," Prev "),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Sb(32,"div",18,19),b.Sb(34,"div",20),b.Sb(35,"div",21),b.Sb(36,"div",22),b.Sb(37,"h4",23),b.Dc(38,"Add/Edit Crop Price"),b.Rb(),b.Sb(39,"button",24),b.Zb("click",function(){return b.vc(t),b.sc(33).hide()}),b.Sb(40,"span",25),b.Dc(41,"\xd7"),b.Rb(),b.Rb(),b.Rb(),b.Sb(42,"div",26),b.Sb(43,"form",27),b.Zb("ngSubmit",function(){return e.cropPriceSubmit()}),b.Sb(44,"div",28),b.Sb(45,"label",29),b.Dc(46,"State"),b.Rb(),b.Sb(47,"select",30),b.Zb("change",function(t){return e.filterMarkets(t)}),b.Sb(48,"option",31),b.Dc(49,"Choose..."),b.Rb(),b.Bc(50,f,2,2,"option",32),b.Rb(),b.Rb(),b.Sb(51,"div",28),b.Sb(52,"label",33),b.Dc(53,"Market"),b.Rb(),b.Sb(54,"select",34),b.Sb(55,"option",31),b.Dc(56,"Choose..."),b.Rb(),b.Bc(57,R,2,2,"option",32),b.Rb(),b.Rb(),b.Sb(58,"div",28),b.Sb(59,"label",35),b.Dc(60,"Crop"),b.Rb(),b.Sb(61,"select",36),b.Sb(62,"option",31),b.Dc(63,"Choose..."),b.Rb(),b.Bc(64,S,2,2,"option",32),b.Rb(),b.Rb(),b.Sb(65,"div",28),b.Sb(66,"label",37),b.Dc(67,"Price"),b.Rb(),b.Nb(68,"input",38),b.Rb(),b.Sb(69,"div",28),b.Sb(70,"label",37),b.Dc(71,"Unit"),b.Rb(),b.Nb(72,"input",39),b.Rb(),b.Sb(73,"div",28),b.Sb(74,"label",40),b.Dc(75,"Image"),b.Rb(),b.Sb(76,"div"),b.Bc(77,P,1,1,"img",41),b.Rb(),b.Sb(78,"input",42),b.Zb("change",function(t){return e.onChange(t)}),b.Rb(),b.Rb(),b.Sb(79,"button",43),b.Zb("click",function(){return b.vc(t),b.sc(33).hide()}),b.Dc(80," Close "),b.Rb(),b.Sb(81,"button",44),b.Bc(82,C,1,0,"span",45),b.Dc(83," Save changes "),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Sb(84,"div",18,46),b.Sb(86,"div",47),b.Sb(87,"div",21),b.Sb(88,"div",48),b.Dc(89," Do you want to approve this record? "),b.Rb(),b.Sb(90,"div",49),b.Sb(91,"button",43),b.Zb("click",function(){return e.approveOrReject(!0)}),b.Dc(92," No! Reject. "),b.Rb(),b.Sb(93,"button",50),b.Zb("click",function(){return e.approveOrReject(!1)}),b.Dc(94," Yes! Approve. "),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb()}2&t&&(b.Ab(6),b.jc("disabled",e.disableButton),b.Ab(2),b.jc("disabled",e.disableButton),b.Ab(2),b.jc("disabled",!e.disableButton),b.Ab(7),b.Fc(" ",e.selectedList,""),b.Ab(5),b.jc("columnDefs",e.columnDefs)("rowData",e.rowData)("rowSelection",e.rowSelection),b.Ab(3),b.Hc("",e.from," to ",e.to," of ",null==e.meta||null==e.meta.pagination?null:e.meta.pagination.total,""),b.Ab(1),b.jc("disabled",e.disableNextButton),b.Ab(3),b.Gc("Page ",null==e.meta||null==e.meta.pagination?null:e.meta.pagination.page," of ",null==e.meta||null==e.meta.pagination?null:e.meta.pagination.pageCount,""),b.Ab(1),b.jc("disabled",e.disablePrevButton),b.Ab(13),b.jc("formGroup",e.cropPriceForm),b.Ab(7),b.jc("ngForOf",e.States),b.Ab(7),b.jc("ngForOf",e.Markets),b.Ab(7),b.jc("ngForOf",e.Crops),b.Ab(13),b.jc("ngIf",e.imageUrl),b.Ab(4),b.jc("disabled",e.btnLoading||!e.cropPriceForm.valid),b.Ab(1),b.jc("ngIf",e.btnLoading))},directives:[a.a,a.d,a.b,p.a,h.a,s.t,s.j,s.e,s.q,s.p,s.i,s.d,s.m,s.u,o.j,s.b,o.k],encapsulation:2}),t})(),data:{roles:"KP_CALLER",title:"Crop Prices"}}]}];let A=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=b.Kb({type:t}),t.\u0275inj=b.Jb({imports:[[c.g.forChild(w)],c.g]}),t})(),k=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=b.Kb({type:t}),t.\u0275inj=b.Jb({imports:[[o.c,r.a,s.o,p.b.withComponents([]),A,a.c.forRoot(),h.b.forRoot(),s.f]]}),t})()}}]);